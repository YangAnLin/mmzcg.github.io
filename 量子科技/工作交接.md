# 

ES

Mybatis

![: 0 ](https://raw.githubusercontent.com/YangAnLin/images/master/20200908153625.png)

# 分支情况

| key          | value |
| ------------ | ----- |
| `prod`       | 线上  |
| `prerelease` | 外侧  |
| `test`       | 内侧  |
| `develop`    | 开发  |

还有些问题:

* 有的服务并不是按照表格中的分支规范,比如prod02,prod_proc 这种,在部署的时候要留意
* 有的服务,只有一个分支
  * 具体情况要看各环境的jenkins打包用的是哪个分支的代码
* 有的服务,甚至是在线上跑的也没有指定用prod的代码
  * 具体情况要看各环境的jenkins打包用的是哪个分支的代码
* 在使用启动命令`java -jar xxx.jar --spring.profiles.active= xxx`这里的时候,应该是指定哪个环境的,通常应该使用的是分支的名字,但是在线上跑的项目,指定的环境也不统一规范

# 迁移数据库

在prerelease分支开发,等到内侧环境弄好,就把原来的`test`分支删掉,把`prerelease`分支的代码拉到`test`分支,再在内侧开发

等到要上线之前,先把``tset--->prerelease`,`prod---->prerelease`(就是把内侧和线上的代码合并,放到外侧分支),合并代码时,解决冲突,内侧和线上有业务冲突的代码,做好标记,上线的时候会用上

到上线的时候,就直接把prerelease的代码替换到prod上,解决冲突的时候,照着之前上外侧的标记解决冲突

## ES

* 所有的查询代码都在`search-service`
  * 通常就是业主系统在用

* 大部分的插入代码也都是`search-service`

* 剩余的插入数据的别的服务也有
  * 拉取第三方的注单,写入数据的时候也会写入ES
  * 天天游戏的写分也,写入数据的时候也会写入ES



