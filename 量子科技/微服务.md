# 上下分要查的表

```sql
# 查询在线玩家
select lo.UserID,info.RegAccounts from RYTreasureDB.dbo.GameScoreLocker as lo left join RYAccountsDB.dbo.AccountsInfo  as info on info.UserID = lo.UserID

# 查询某个玩家的上下分记录
SELECT Account,H5Account,BeforeScore,AfterScore,OperationScore,InsertDate,OperationDescribe,BeforeWalletScore,AfterWalletScore FROM RYTreasureDB.dbo.Api_RecordDrawScore where H5Account = 'l0c004e4eb' order by InsertDate DESC
```

```yaml
# 上下分工具用到的数据
http://P001te34a2i.mu622.com/channel
106
NrzkgmMl
DyQxsj73
bxvip253

# API业主系统的资金帐变查询结构
/agentControl/getApiRecordDrawScoreList

# 状态码
10 登录
20 上分
30 下分
```

## 查询业主的API的秘钥

```
SELECT AgentID,AgentAcc,Pwd,DESKey,MD5Key,score FROM  T_Acc_Agent Where AgentId=#{agentId} And IsClient=5
```



## 业主系统的权限关系

```shell
SELECT DISTINCT
			RP.PermissionID
		FROM
			RYAgentDB.T_Agent_PageRolePermission RP
			INNER JOIN RYAgentDB.T_Agent_RoleGroup rg ON rg.GroupID = RP.GroupID
			AND rg.AgentID = 160


T_Agent_RoleGroup  用户所拥有的角色 
GroupID = GroupID
T_Agent_PageRolePermission 用户所拥有的用户的权限

R_agnet_role 角色表

T_Agent_PagePermission 定义所有的权限
```

# 全名代理

```sql
-- 获取所有返佣方案为负盈利的玩家ID
select UserID from RYAccountsDB.dbo.AccountsInfo
where ProgramID not in ('0') and ProgramID != '无' and ProgramID != '' 

-- 根据业主ID查找禁止列表
select ttConfig,otherConfig from RYPlatformDB.PXD_GameConfig where agentId = 160

-- 获取该玩家的负盈利列表,只有一条记录
select id,UserDefinition,UserDefinitionValue from RYAgentDB.PXD_FYLProgram
where ID = #{programId} and AgentId = #{agentId}

-- 获取该玩家的负盈利的具体配置
select Profit,EffectiveUser,CommissionLimit,Configurations
from RYAgentDB.PXD_FYLProgramConfigurations where ProgramID = #{id}
```

# 负盈利

```shell
负盈利定时器
com/lzkj/agent/schedule/FYLSchedule.java:41

//1.先获取所有返佣方案为负盈利的玩家ID
//List<Integer> list = accountsServiceClient.getFYLMan();
List<Integer> list = new ArrayList<>();
list.add(803821);


天天定时器
com/lzkj/agent/schedule/TTSchedule.java:41
ArrayList<Integer> objects = new ArrayList<>();
objects.add(803822);
//accountsServiceClient.getTTMan().forEach(userId -> {
objects.forEach(userId -> {
```

# 代理

```shell
T_Acc_Agent  业主有关系的表,注册新用户,会更新playerCount()
```



# 业主

```shell

```



# 游戏

|                             |                            |
| --------------------------- | -------------------------- |
| RYTreasureDB.T_VideoType    | 有哪些平台,AG,BG....之类的 |
| RYPlatformDB.ThirdKindItem  | 第三方游戏的列表和基本配置 |
| RYPlatformDB.MobileKindItem | 天天游戏的列表和基本配置   |
|                             |                            |
|                             |                            |
|                             |                            |
|                             |                            |
|                             |                            |
|                             |                            |

# 公告

|              |          |
| ------------ | -------- |
| News         | 新闻公告 |
| T_Agent_News | 游戏公告 |
|              |          |
|              |          |

# 活动

|          |                    |
| -------- | ------------------ |
| Activity | 活动(配置展示活动) |
|          |                    |
|          |                    |
|          |                    |

# 支付

|                 |          |
| --------------- | -------- |
| GlobalShareInfo | 支付类型 |
|                 |          |
|                 |          |
|                 |          |

