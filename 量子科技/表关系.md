# 上下分要查的表

```sql
# 查询在线玩家
select lo.UserID,info.RegAccounts from RYTreasureDB.dbo.GameScoreLocker as lo left join RYAccountsDB.dbo.AccountsInfo  as info on info.UserID = lo.UserID

# 查询某个玩家的上下分记录
SELECT Account,H5Account,BeforeScore,AfterScore,OperationScore,InsertDate,OperationDescribe,BeforeWalletScore,AfterWalletScore FROM RYTreasureDB.dbo.Api_RecordDrawScore where H5Account = 'l0c004e4eb' order by InsertDate DESC
```

```yaml
# 上下分工具用到的数据
http://P001te34a2i.mu622.com/channel
106
NrzkgmMl
DyQxsj73
bxvip253

# API业主系统的资金帐变查询结构
/agentControl/getApiRecordDrawScoreList

# 状态码
10 登录
20 上分
30 下分

# 业主账号
https://api-agent.wm732.com
天天暴雪           用户名：TT-Api111         密码：123456
D2                   用户名：TT-Api119         密码：xp1314521
```

## 查询业主的API的秘钥

```
SELECT AgentID,AgentAcc,Pwd,DESKey,MD5Key,score FROM  T_Acc_Agent Where AgentId=#{agentId} And IsClient=5
```



## 业主系统的权限关系

```shell
SELECT DISTINCT
			RP.PermissionID
		FROM
			RYAgentDB.T_Agent_PageRolePermission RP
			INNER JOIN RYAgentDB.T_Agent_RoleGroup rg ON rg.GroupID = RP.GroupID
			AND rg.AgentID = 160


T_Agent_RoleGroup  用户所拥有的角色 
GroupID = GroupID
T_Agent_PageRolePermission 用户所拥有的用户的权限

R_agnet_role 角色表

T_Agent_PagePermission 定义所有的权限
```

# 全名代理

```sql
-- 获取所有返佣方案为负盈利的玩家ID
select UserID from RYAccountsDB.dbo.AccountsInfo
where ProgramID not in ('0') and ProgramID != '无' and ProgramID != '' 

-- 根据业主ID查找禁止列表
select ttConfig,otherConfig from RYPlatformDB.PXD_GameConfig where agentId = 160

-- 获取该玩家的负盈利列表,只有一条记录
select id,UserDefinition,UserDefinitionValue from RYAgentDB.PXD_FYLProgram
where ID = #{programId} and AgentId = #{agentId}

-- 获取该玩家的负盈利的具体配置
select Profit,EffectiveUser,CommissionLimit,Configurations
from RYAgentDB.PXD_FYLProgramConfigurations where ProgramID = #{id}
```

# 负盈利

## 负盈利定时器

```shell
负盈利定时器
com/lzkj/agent/schedule/FYLSchedule.java:41

//1.先获取所有返佣方案为负盈利的玩家ID
//List<Integer> list = accountsServiceClient.getFYLMan();
List<Integer> list = new ArrayList<>();
list.add(803821);


天天定时器
com/lzkj/agent/schedule/TTSchedule.java:41
ArrayList<Integer> objects = new ArrayList<>();
objects.add(803822);
//accountsServiceClient.getTTMan().forEach(userId -> {
objects.forEach(userId -> {
```

## 表结构

|                              |                                                     |
| ---------------------------- | --------------------------------------------------- |
| PXD_AuditRecord              | 负盈利申请记录                                      |
| PXD_FYLApplicationForm       | 返佣设置->参数设置,应该是  游戏用户申请负盈利的条件 |
| PXD_FYLProgram               | 负盈利方案                                          |
| PXD_FYLProgramConfigurations | 负盈利方案具体配置                                  |
| PXD_FYLRewardReview          | 负盈利审核                                          |
| PXD_FYLRewardRecord          | 负盈利返佣记录                                      |
| PXD_GameConfig               | 负盈利禁用哪些游戏不产生负盈利                      |
|                              |                                                     |
| PXD_TTRewardRecord           | 天天返佣记录                                        |
| PXD_TTProgramConfigurations  | 天天返佣配置                                        |



# 代理

```shell
T_Acc_Agent  业主有关系的表,注册新用户,会更新playerCount()
```



# 业主

```shell

```



# 游戏

|                             |                                                   |                  |        |
| --------------------------- | ------------------------------------------------- | ---------------- | ------ |
| RYTreasureDB.T_VideoType    | 有哪些平台,,之前mongo来用的                       | AG,BG....之类的  | 定义表 |
| RYPlatformDB.ThirdKindItem  | 第三方游戏的列表和基本配置,具体游戏和平台的关系表 |                  |        |
| RYPlatformDB.MobileKindItem | 天天游戏的列表和基本配置                          |                  |        |
|                             |                                                   |                  |        |
| ThirdKindItem               | 具体游戏,定义游戏和平台的关系                     | AG平台有哪些游戏 | 定义表 |
| GameTypeItem                | 游戏类型,比如 棋牌,捕鱼,                          |                  | 定义表 |
| GamePlatformName            | 业主和平台的关系表                                |                  |        |
| ThirdKindConfig             | 业主,平台,具体游戏,游戏表,缺少TypeId字段          |                  |        |
|                             |                                                   |                  |        |
| T_ChannelGame_UserDayBet    | 打码量表                                          |                  | 记录表 |

# 公告

|              |          |
| ------------ | -------- |
| News         | 新闻公告 |
| T_Agent_News | 游戏公告 |
|              |          |
|              |          |

# 活动

|          |                    |
| -------- | ------------------ |
| Activity | 活动(配置展示活动) |
|          |                    |
|          |                    |
|          |                    |

# 支付

|                 |          |
| --------------- | -------- |
| GlobalShareInfo | 支付类型 |
|                 |          |
|                 |          |
|                 |          |

# 第三方

|                          |                                  |        |
| ------------------------ | -------------------------------- | ------ |
| ChannelGameOperateRecord | 登录第三方要写的记录,0成功,2失败 | 记录表 |
|                          |                                  |        |
|                          |                                  |        |
|                          |                                  |        |
|                          |                                  |        |

# 帐变类型

优惠总额,有这些`(1,2,3,6,7,21,24,25,27,32,101,102,150,153,154,155,156,157,158,159,160,163,165)`

| TypeId | 说明               | 备注                                                         |
| :----- | :----------------- | ------------------------------------------------------------ |
| 3      | 签到赠送           | 每日签到                                                     |
| 7      | 任务奖励           |                                                              |
| 18     | 人工存入           |                                                              |
| 21     | 活动优惠           | 手动(人工存提)<br />活动优惠(完成活动,系统自动派发)<br />活动优惠(完成活动,手动派发) |
| 24     | VIP晋级奖励        | VIP晋级奖励<br />VIP周奖励<br />VIP月奖励                    |
| 25     | 每日首存赠送       |                                                              |
| 32     | 绑手机赠送         |                                                              |
| 48     | 第三方充值         |                                                              |
| 57     | 公司支付           |                                                              |
| 101    | 公司充值返还       |                                                              |
| 150    | 人工存入返利       | 自动和手动                                                   |
| 153    | 洗码奖励           |                                                              |
| 154    | 每日登录红包奖励   |                                                              |
| 155    | 每日充值红包奖励   |                                                              |
| 156    | 累计充值红包奖励   |                                                              |
| 157    | 每日打码量红包奖励 |                                                              |
| 158    | 累计打码量红包奖励 |                                                              |
| 160    | 红包雨             |                                                              |
| 165    | 第三方充值返利     | 自动,没有手动                                                |
| 183    | 余额宝转出         |                                                              |
